<?php

use Drupal\node\Entity\Node;
use Drupal\tigre_custom\Rest\TigreRestService;

/**
 * Implements hook_preprocess_HOOK().
 */
function tigre_custom_preprocess_form_element(&$variables) {

  if ($variables['element']['#id'] == 'edit-name') {
    $variables['attributes']['class'][] = 'col-md-6';
    $variables['#title'] = t('Name');
  }

  if ($variables['element']['#id'] == 'edit-mail') {
    $variables['attributes']['class'][] = 'col-md-6';
  }

  if ($variables['element']['#id'] == 'edit-field-contato-profissao') {
    $variables['attributes']['class'][] = 'col-md-6';
  }

  if ($variables['element']['#id'] == 'edit-field-contato-empresa-0-value') {
    $variables['attributes']['class'][] = 'col-md-6';
  }


  if ($variables['element']['#id'] == 'edit-field-contato-celular-0-value') {
    $variables['attributes']['class'][] = 'col-md-6';
  }


  if ($variables['element']['#id'] == 'edit-field-contato-telefone-0-value') {
    $variables['attributes']['class'][] = 'col-md-3';
  }


  if ($variables['element']['#id'] == 'edit-field-contato-celular-0-value') {
    $variables['attributes']['class'][] = 'col-md-3';
  }

  if ($variables['element']['#id'] == 'edit-field-contato-pais') {
    $variables['attributes']['class'][] = 'col-md-6';
  }


  if ($variables['element']['#id'] == 'edit-message-0-value') {
    $variables['attributes']['class'][] = 'col-md-12';
  }


}

/**
 * Implements hook_cronapi().
 */
function tigre_custom_cronapi() {
  $items = array();
  $items['_tigre_custom_import_produto'] = array();
  return $items;
}

/**
 * Implements hook_cron().
 */
function tigre_custom_cron() {
  tigre_list_products();
}

function tigre_list_products() {
  /** @var TigreRestService $tigre_service */
  $tigre_service = new TigreRestService();
  $tigre_service->setHost("http://34.193.90.181");
  //$tigre_service->setHost("https://www.tigre.com.br");
  $tigre_service->setUsername("lucas");
  $tigre_service->setPassword('102030');
  $produtos = $tigre_service->getProducts();

  foreach ($produtos as $nid => $produto) {

    $produto_language = $produto['pt-br'];
    $detail = $tigre_service->getDetailProduct($produto_language['url']);
    /** @var \Drupal\node\Entity\Node $current_product */
    $current_product = \Drupal::service('entity.repository')->loadEntityByUuid('node', $detail['uuid']['0']['value']);

    if (empty($current_product)) {
      $node = Node::create([
        'type' => 'produto',
      ]);
    }
    else {
      $node = Node::load($current_product->id());
    }

    $node->set('uuid', $detail['uuid'][0]['value']);
    $node->set('title', $detail['title'][0]['value']);
    $node->set('body', $detail['body'][0]['value']);
    /*if (!empty($detail['field_produto_banners'])) {
      $node->set('field_produto_banners', $detail['field_produto_banners'][0]['value']);
    }*/
    if (!empty($detail['field_produto_chamada'])) {
      $node->set('field_produto_chamada', $detail['field_produto_chamada'][0]['value']);
    }
    if (!empty($detail['field_produto_descricao'])) {
      $node->set('field_produto_descricao', $detail['field_produto_descricao'][0]['value']);
    }
    if (!empty($detail['field_desenho_tecnico'])) {
      $node->set('field_desenho_tecnico', $detail['field_desenho_tecnico'][0]['value']);
    }
    if (!empty($detail['field_ficha_seguranca'])) {
      $node->set('field_ficha_seguranca', $detail['field_ficha_seguranca'][0]['value']);
    }
    if (!empty($detail['field_ficha_tecnica'])) {
      $node->set('field_ficha_tecnica', $detail['field_ficha_tecnica'][0]['value']);
    }
    if (!empty($detail['field_produtos_instrucoes'])) {
      $node->set('field_produto_instrucoes', $detail['field_produtos_instrucoes'][0]['value']);
    }
    if (!empty($detail['field_keywords'])) {
      $node->set('field_keywords', $detail['field_keywords'][0]['value']);
    }
    if (!empty($detail['field_label_aba_1'])) {
      $node->set('field_label_aba_1', $detail['field_label_aba_1'][0]['value']);
    }
    if (!empty($detail['field_label_aba_2'])) {
      $node->set('field_label_aba_2', $detail['field_label_aba_2'][0]['value']);
    }
    if (!empty($detail['field_label_aba_3'])) {
      $node->set('field_label_aba_3', $detail['field_label_aba_3'][0]['value']);
    }
    if (!empty($detail['field_label_coluna_1_aba_1'])) {
      $node->set('field_label_coluna_1_aba_1', $detail['field_label_coluna_1_aba_1'][0]['value']);
    }
    if (!empty($detail['field_label_coluna_2_aba_1'])) {
      $node->set('field_label_coluna_2_aba_1', $detail['field_label_coluna_2_aba_1'][0]['value']);
    }
    if (!empty($detail['field_label_da_coluna_modelo'])){
      $node->set('field_label_da_coluna_modelo', $detail['field_label_da_coluna_modelo'][0]['value']);
    }
    if (!empty($detail['field_meta_tags'])) {
      $node->set('field_meta_tags', $detail['field_meta_tags'][0]['value']);
    }
    if (!empty($detail['field_prioridade'])) {
      $node->set('field_prioridade', $detail['field_prioridade'][0]['value']);
    }
    if (!empty($detail['field_produto_genero'])) {
      $node->set('field_produto_genero', $detail['field_produto_genero'][0]['value']);
    }
    if (!empty($detail['field_produto_revisado'])) {
      $node->set('field_produto_revisado', $detail['field_produto_revisado'][0]['value']);
    }
//      $node->set('field_taxonomy_catalog', $detail['taxonomy_catalog']['value']);
    if (!empty($detail['field_texto_tecnico'])){
      $node->set('field_texto_tecnico', $detail['field_texto_tecnico'][0]['value']);
    }
    if (!empty($detail['field_titulo_especificacao'])) {
      $node->set('field_titulo_especificacao', $detail['field_titulo_especificacao'][0]['value']);
    }
    if (!empty($detail['field_video'])) {
      $node->set('field_video', $detail['field_video'][0]['value']);
    }
    if (!empty($detail['field_video_titulo'])) {
      $node->set('field_video_titulo', $detail['field_video_titulo'][0]['value']);
    }

    $node->save();

    //die();


  }

}